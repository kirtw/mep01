<!DOCTYPE html>
<html lang='en'>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>
^epW
</title>
<style> 
.hd  {font-size: 2em;}
body  {font-size:100%;}
.cdline  {font-family: "Courier New", monospace;   font-size: 1em;}
.cdline  {display: flex; flex-direction: row; flex-wrap: nowrap; justify-content: space-between; }
.cdrinum  {flex: 1;}
.cdlabel  {flex: 5;}
.cdmcmd  {flex: 94;}
.cdline  {white-space:pre-wrap; }
.cdmcmd  {text-indent:5px white-space:pre-wrap;}
.cdline  {background-color:gray}
.cdrinum  {background-color:gold; width:100px ; margin-right:5px}
.cdlabel  {background-color:lightblue}
.cdmcmd  {background-color:lightpink}
a  {margin:5px 0px 5px 0px;}
.brcln  {display: flex; flex-direction: row; flex-wrap: nowrap; justify-content: space-between; }
a  {flex: 1;}
.blink  {flex: 1;}
.brcln  {white-space:pre-wrap; flex-wrap: wrap;}
.brcln  {font-size: 1.4em; font-family: "Courier New", monospace; }
.blink  {margin-left: 10px;margin-right: 10px;text-decoration: none;}
.blink  {padding-left: 5px; padding-right: 20px;border: black solid 1px;}
.blink  {background-color: lightpink;}
.cursor  {background-color:lightyellow;}
</style>
</head>
<body>
<div  class=hd >MRoutine Page ^epW</div><a href=aa-TOC-All.zz2.html >TOC</a><div  class=brcln ><a href=aa-TOC-All.zz2.html >TOC</a><div  class=blink ><a href=RD-rxmep1.rd2.html >rxmep1/</a></div><div  class=blink ><a href=MR-epW.mr2.html >^epW</a></div><div  class=blink ><a href=./ >ww2m/*</a></div><div  class=blink ><a href=CB-epW.cb2.html >^epW</a></div><div  class=blink ><a href=CB-epW-WGR.cb2.html >WGR</a></div><div  class=blink ><a href=CB-epW-RPlodash.cb2.html >RPlodash</a></div><div  class=blink ><a href=CB-epW-EXRP.cb2.html >EXRP</a></div><div  class=blink ><a href=CB-epW-WKRP.cb2.html >WKRP</a></div><div  class=blink ><a href=CB-epW-WSC.cb2.html >WSC</a></div><div  class=blink ><a href=CB-epW-WS.cb2.html >WS</a></div><div  class=blink ><a href=CB-epW-WRP.cb2.html >WRP</a></div><div  class=blink ><a href=CB-epW-WIN.cb2.html >WIN</a></div><div  class=blink ><a href=CB-epW-DSP.cb2.html >DSP</a></div><div  class=blink ><a href=CB-epW-TSP.cb2.html >TSP</a></div></div><div  class=mcode ><div  class=cdline ><div  class=cdrinum >..1c</div><div  class=cdmcmd >epW  ;CKW/ESC i31oct22 rMP1/ ;20221031-60;Write sr for parser data structures</div></div><div  class=cdline ><div  class=cdrinum >..2c</div><div  class=cdmcmd >;</div></div><div  class=cdline ><div  class=cdrinum >..3c</div><div  class=cdmcmd >;</div></div><div  class=cdline ><div  class=cdrinum >..4c</div><div  class=cdmcmd >;</div></div><div  class=cdline ><div  class=cdrinum >..5c</div><div  class=cdmcmd >;*</div></div><div  class=cdline ><div  class=cdrinum >..6c</div><div  class=cdmcmd >;*  GRi(gsq)=RPgr,   Gxq(runa,gi)=gsq</div></div><div  class=cdline ><div  class=cdrinum >..7c</div><div  class=cdmcmd >;  RPgr =1 is ruab, _2 is IPs, _3 is IPc, GRde(ruab)=rude  comment, for what ?</div></div><div  class=cdline ><div  class=cdrinum >..8c</div><div  class=cdmcmd >; This is all static after <a href=CB-KGD-init.cb2.html >init</a> <a href=CB-KGD-setup.cb2.html >setup</a> by IG</div></div><div  class=cdline ><div  class=cdrinum >..9c</div><div  class=cdmcmd ><a href=CB-epW-WGR.cb2.html >WGR</a>    W !!,"Grammar GRr() rules-"</div></div><div  class=cdline ><div  class=cdrinum >.10c</div><div  class=cdmcmd >       NEW gsq,ruab,ina,gi,ruab,ti,RPgr,rde,runa,ruLst,tok</div></div><div  class=cdline ><div  class=cdrinum >.11c</div><div  class=cdmcmd >       F gsq=1:1:GRi S RPgr=GRi(gsq)   DO  ;</div></div><div  class=cdline ><div  class=cdrinum >.12c</div><div  class=cdmcmd >         .W:$X ! W RPgr</div></div><div  class=cdline ><div  class=cdrinum >.13c</div><div  class=cdmcmd >         .D <a href=CB-epW-EXRP.cb2.html >EXRP</a>(RPgr)</div></div><div  class=cdline ><div  class=cdrinum >.14c</div><div  class=cdmcmd >         .W:$X ! W:$P(ruab,".",2)=1 runa,"  "</div></div><div  class=cdline ><div  class=cdrinum >.15c</div><div  class=cdmcmd >         .W ?10</div></div><div  class=cdline ><div  class=cdrinum >.16c</div><div  class=cdmcmd >         .F ti=1:1:$L(ruLst,",") S tok=$P(ruLst,",",ti) DO  ;</div></div><div  class=cdline ><div  class=cdrinum >.17c</div><div  class=cdmcmd >            ..S Tna=$G(WNa(tok)) I Tna="" S Tna=tok D b^dv("Err msg Lna ;4 ","tok,Tna")</div></div><div  class=cdline ><div  class=cdrinum >.18c</div><div  class=cdmcmd >            ..W Tna," "</div></div><div  class=cdline ><div  class=cdrinum >.19c</div><div  class=cdmcmd >       W ?40,"(",IPs,") ",!</div></div><div  class=cdline ><div  class=cdrinum >.20c</div><div  class=cdmcmd >       Q</div></div><div  class=cdline ><div  class=cdrinum >.21c</div><div  class=cdmcmd >;*</div></div><div  class=cdline ><div  class=cdrinum >.22c</div><div  class=cdmcmd ><a href=CB-epaG0-RPlodash.cb2.html >RPlodash</a> ; _1 runa.gi / rusq, _2 IPs, _3 Ipe~Si, _4 dot, _5 ruLst, _6 frm, _7, _8</div></div><div  class=cdline ><div  class=cdrinum >.23c</div><div  class=cdmcmd >;*  Expand RP to locals</div></div><div  class=cdline ><div  class=cdrinum >.24c</div><div  class=cdmcmd ><a href=CB-epW-EXRP.cb2.html >EXRP</a>(RP,Swi,Swj)  I $G(RP)="" D bug^dv("Arg RP ","RP") Q</div></div><div  class=cdline ><div  class=cdrinum >.25c</div><div  class=cdmcmd >       S nRP=$L(RP,"_") I nRP'&gt;4 D b^dv("Err _len RP 5 or 6","RP") Q</div></div><div  class=cdline ><div  class=cdrinum >.26c</div><div  class=cdmcmd >       S Swi=$G(Swi),Swj=$G(Swj)</div></div><div  class=cdline ><div  class=cdrinum >.27c</div><div  class=cdmcmd >       NEW <a href=CB-GP6-P1.cb2.html >P1</a></div></div><div  class=cdline ><div  class=cdrinum >.28c</div><div  class=cdmcmd >       S <a href=CB-GP6-P1.cb2.html >P1</a>=$P(RP,"_",1)</div></div><div  class=cdline ><div  class=cdrinum >.29c</div><div  class=cdmcmd >       S ruab=$P(<a href=CB-GP6-P1.cb2.html >P1</a>,"/")  ;runa.gi</div></div><div  class=cdline ><div  class=cdrinum >.30c</div><div  class=cdmcmd >       S runa=$P(ruab,".")  ; ~ left-hand side, name (no .ri ?)</div></div><div  class=cdline ><div  class=cdrinum >.31c</div><div  class=cdmcmd >       S rugi=$P(ruab,".",2)</div></div><div  class=cdline ><div  class=cdrinum >.32c</div><div  class=cdmcmd >       S rusq=$P($P($P(RP,"=",1),"/",2)," ")  ; grammar index number, gsi~gsq~rusq</div></div><div  class=cdline ><div  class=cdrinum >.33c</div><div  class=cdmcmd >         I rusq'=+rusq D b^dv("Err rusq should be integer","rusq,RP")</div></div><div  class=cdline ><div  class=cdrinum >.34c</div><div  class=cdmcmd >       S ruLst=$P(RP,"_",5)  ; comma list</div></div><div  class=cdline ><div  class=cdrinum >.35c</div><div  class=cdmcmd >       S dot=$P(RP,"_",4)  ; dot ptr into ruLst</div></div><div  class=cdline ><div  class=cdrinum >.36c</div><div  class=cdmcmd >       S IPs=$P(RP,"_",2)</div></div><div  class=cdline ><div  class=cdrinum >.37c</div><div  class=cdmcmd >       S IPe=$P(RP,"_",3)  ; = Si redundant</div></div><div  class=cdline ><div  class=cdrinum >.38c</div><div  class=cdmcmd >       S INse=$E($G(Ins),IPs,IPe)  ; Ins is input string</div></div><div  class=cdline ><div  class=cdrinum >.39c</div><div  class=cdmcmd >       S TokR1=$P(ruLst,",",dot+1)  ; may be null if done</div></div><div  class=cdline ><div  class=cdrinum >.40c</div><div  class=cdmcmd >       S rde=$G(GRde(ruab))</div></div><div  class=cdline ><div  class=cdrinum >.41c</div><div  class=cdmcmd >       ; audit</div></div><div  class=cdline ><div  class=cdrinum >.42c</div><div  class=cdmcmd >       I Swi'="",Swi'=IPe D b^dv("Err Swi not eq IPe_3","Swi,IPe,IPs,RPd")</div></div><div  class=cdline ><div  class=cdrinum >.43c</div><div  class=cdmcmd >       Q</div></div><div  class=cdline ><div  class=cdrinum >.44c</div><div  class=cdmcmd >;*</div></div><div  class=cdline ><div  class=cdrinum >.45c</div><div  class=cdmcmd >;*  Write one item ala Lua Loup format for comparison</div></div><div  class=cdline ><div  class=cdrinum >.46c</div><div  class=cdmcmd >; WNa substitutes full Lua name</div></div><div  class=cdline ><div  class=cdrinum >.47c</div><div  class=cdmcmd >; RP and rula, ruLst, dot, IPs</div></div><div  class=cdline ><div  class=cdrinum >.48c</div><div  class=cdmcmd ><a href=CB-epW-WKRP.cb2.html >WKRP</a>(RPd,Swi,Swj)  I $G(RPd)="" D bug^dv Q</div></div><div  class=cdline ><div  class=cdrinum >.49c</div><div  class=cdmcmd >       NEW runa,IPs,ruLst,dot,Lna,ti,tok</div></div><div  class=cdline ><div  class=cdrinum >.50c</div><div  class=cdmcmd >       S Swi=$G(Swi),Swj=$G(Swj)</div></div><div  class=cdline ><div  class=cdrinum >.51c</div><div  class=cdmcmd >       D <a href=CB-epW-EXRP.cb2.html >EXRP</a>(RPd,Swi,Swj)</div></div><div  class=cdline ><div  class=cdrinum >.52c</div><div  class=cdmcmd >       ;W:$X ! S Lna=$G(WNa(runa)) I Lna="" D b^dv("Missing Lna","runa") S Lna=runa</div></div><div  class=cdline ><div  class=cdrinum >.53c</div><div  class=cdmcmd >       ;W Lna," ",?8," -&gt; "</div></div><div  class=cdline ><div  class=cdrinum >.54c</div><div  class=cdmcmd >       F ti=1:1:$L(ruLst,",")+1 S tok=$P(ruLst,",",ti) DO</div></div><div  class=cdline ><div  class=cdrinum >.55c</div><div  class=cdmcmd >         .I (dot+1)=ti W "  *  "</div></div><div  class=cdline ><div  class=cdrinum >.56c</div><div  class=cdmcmd >         .I tok="" Q  ; no more tok, extra to do dot at end</div></div><div  class=cdline ><div  class=cdrinum >.57c</div><div  class=cdmcmd >         .S Lna=$G(WNa(tok)) I Lna="" DO  ;</div></div><div  class=cdline ><div  class=cdrinum >.58c</div><div  class=cdmcmd >            ..D b^dv("Err Missing Lna of tok","tok,WNa,ti,rulst")</div></div><div  class=cdline ><div  class=cdrinum >.59c</div><div  class=cdmcmd >            ..S Lna=" ??? "</div></div><div  class=cdline ><div  class=cdrinum >.60c</div><div  class=cdmcmd >         .W Lna,"  "</div></div><div  class=cdline ><div  class=cdrinum >.61c</div><div  class=cdmcmd >       W ?50,"(",IPs-1,")",!</div></div><div  class=cdline ><div  class=cdrinum >.62c</div><div  class=cdmcmd >       Q</div></div><div  class=cdline ><div  class=cdrinum >.63c</div><div  class=cdmcmd >;*  SC()  Write all, Lua Loup Compatible output lines</div></div><div  class=cdline ><div  class=cdrinum >.64c</div><div  class=cdmcmd ><a href=CB-epW-WSC.cb2.html >WSC</a>    W:$X !,"Complete Table-",!!</div></div><div  class=cdline ><div  class=cdrinum >.65c</div><div  class=cdmcmd >       NEW Si,Swi,Swj</div></div><div  class=cdline ><div  class=cdrinum >.66c</div><div  class=cdmcmd >       F Si=1:1:SC  Q:$D(SC(Si))=0  D <a href=CB-epW-WS.cb2.html >WS</a>(Si)</div></div><div  class=cdline ><div  class=cdrinum >.67c</div><div  class=cdmcmd >       W !!</div></div><div  class=cdline ><div  class=cdrinum >.68c</div><div  class=cdmcmd >       Q</div></div><div  class=cdline ><div  class=cdrinum >.69c</div><div  class=cdmcmd >;*  SC(Swi,Swj)</div></div><div  class=cdline ><div  class=cdrinum >.70c</div><div  class=cdmcmd ><a href=CB-epW-WS.cb2.html >WS</a>(Swi)  W:$X ! W !,"     ====== ",Si-1," ====== Sbi=",Swi," ",!</div></div><div  class=cdline ><div  class=cdrinum >.71c</div><div  class=cdmcmd >       F Swj=1:1 Q:$D(SC(Swi,Swj))=0  S RPw=$G(SC(Swi,Swj)) DO  ;</div></div><div  class=cdline ><div  class=cdrinum >.72c</div><div  class=cdmcmd >         .I RPw="" D bug^dv Q</div></div><div  class=cdline ><div  class=cdrinum >.73c</div><div  class=cdmcmd >         .D <a href=CB-epW-WRP.cb2.html >WRP</a>(RPw)</div></div><div  class=cdline ><div  class=cdrinum >.74c</div><div  class=cdmcmd >       W !</div></div><div  class=cdline ><div  class=cdrinum >.75c</div><div  class=cdmcmd >       Q</div></div><div  class=cdline ><div  class=cdrinum >.76c</div><div  class=cdmcmd >;*  Write one item ala Lua Loup format for comparison</div></div><div  class=cdline ><div  class=cdrinum >.77c</div><div  class=cdmcmd >; WNa substitutes full Lua name</div></div><div  class=cdline ><div  class=cdrinum >.78c</div><div  class=cdmcmd >; RP and rula, ruLst, dot, IPs</div></div><div  class=cdline ><div  class=cdrinum >.79c</div><div  class=cdmcmd ><a href=CB-epW-WRP.cb2.html >WRP</a>(RPd)  I $G(RPd)="" D bug^dv Q</div></div><div  class=cdline ><div  class=cdrinum >.80c</div><div  class=cdmcmd >       NEW runa,IPs,ruLst,dot,Lna,ti,tok</div></div><div  class=cdline ><div  class=cdrinum >.81c</div><div  class=cdmcmd >       S runa=$P(RPd,"."),ruLst=$P(RPd,"_",5),IPs=$P(RPd,"_",2),dot=$P(RPd,"_",4)</div></div><div  class=cdline ><div  class=cdrinum >.82c</div><div  class=cdmcmd >       W:$X ! S Lna=$G(WNa(runa)) I Lna="" D b^dv("Missing Lna","runa") S Lna=runa</div></div><div  class=cdline ><div  class=cdrinum >.83c</div><div  class=cdmcmd >       W Lna," ",?8," -&gt; "</div></div><div  class=cdline ><div  class=cdrinum >.84c</div><div  class=cdmcmd >       F ti=1:1:$L(ruLst,",")+1 S tok=$P(ruLst,",",ti) DO</div></div><div  class=cdline ><div  class=cdrinum >.85c</div><div  class=cdmcmd >         .I (dot+1)=ti W "  *  "</div></div><div  class=cdline ><div  class=cdrinum >.86c</div><div  class=cdmcmd >         .I tok="" Q  ; no more tok, extra to do dot at end</div></div><div  class=cdline ><div  class=cdrinum >.87c</div><div  class=cdmcmd >         .S Lna=$G(WNa(tok)) I Lna="" DO  ;</div></div><div  class=cdline ><div  class=cdrinum >.88c</div><div  class=cdmcmd >            ..D b^dv("Err Missing Lna of tok","tok,WNa,ti,rulst")</div></div><div  class=cdline ><div  class=cdrinum >.89c</div><div  class=cdmcmd >            ..S Lna=" ??? "</div></div><div  class=cdline ><div  class=cdrinum >.90c</div><div  class=cdmcmd >         .W Lna,"  "</div></div><div  class=cdline ><div  class=cdrinum >.91c</div><div  class=cdmcmd >       W ?50,"(",IPs-1,")",!</div></div><div  class=cdline ><div  class=cdrinum >.92c</div><div  class=cdmcmd >       Q</div></div><div  class=cdline ><div  class=cdrinum >.93c</div><div  class=cdmcmd >;*</div></div><div  class=cdline ><div  class=cdrinum >.94c</div><div  class=cdmcmd >;*   INc(), INty()   <a href=CB-TOIpd-itb.cb2.html >Itb</a>()</div></div><div  class=cdline ><div  class=cdrinum >.95c</div><div  class=cdmcmd ><a href=CB-epW-WIN.cb2.html >WIN</a>   W:$X ! W !,"Inputs-"   NEW wi</div></div><div  class=cdline ><div  class=cdrinum >.96c</div><div  class=cdmcmd >      I $G(Ins) W !,"In str '",Ins,"'  "</div></div><div  class=cdline ><div  class=cdrinum >.97c</div><div  class=cdmcmd >      W !,"Ip: " F wi=1:1:INc W ?<a href=CB-TOIpd-itb.cb2.html >Itb</a>(wi),wi," "</div></div><div  class=cdline ><div  class=cdrinum >.98c</div><div  class=cdmcmd >      W !,"lit " F wi=1:1:INc W ?<a href=CB-TOIpd-itb.cb2.html >Itb</a>(wi),INc(wi)," "</div></div><div  class=cdline ><div  class=cdrinum >.99c</div><div  class=cdmcmd >      W !,"ty: " F wi=1:1:INc W ?<a href=CB-TOIpd-itb.cb2.html >Itb</a>(wi),INty(wi)," "</div></div><div  class=cdline ><div  class=cdrinum >100c</div><div  class=cdmcmd >      W !</div></div><div  class=cdline ><div  class=cdrinum >101c</div><div  class=cdmcmd >      Q</div></div><div  class=cdline ><div  class=cdrinum >102c</div><div  class=cdmcmd >;* Copy from ^dvs  same <a href=CB-dzroz-as.cb2.html >as</a> ^dvc</div></div><div  class=cdline ><div  class=cdrinum >103c</div><div  class=cdmcmd > ;Replace all dbl spaces (or more) with single, and remove starting/ending</div></div><div  class=cdline ><div  class=cdrinum >104c</div><div  class=cdmcmd ><a href=CB-epW-DSP.cb2.html >DSP</a>(X) NEW i F i=0:1 Q:X'["  "  S X=$P(X,"  ")_" "_$P(X,"  ",2,9999)</div></div><div  class=cdline ><div  class=cdrinum >105c</div><div  class=cdmcmd > Q $$<a href=CB-epW-TSP.cb2.html >TSP</a>(X)</div></div><div  class=cdline ><div  class=cdrinum >106c</div><div  class=cdmcmd > ; Remove <a href=CB-KGD-start.cb2.html >start</a> and end spaces (only)</div></div><div  class=cdline ><div  class=cdrinum >107c</div><div  class=cdmcmd ><a href=CB-epW-TSP.cb2.html >TSP</a>(X) NEW i S X=$<a href=CB-dzIzro-TR.cb2.html >TR</a>(X,$C(9)_$C(10)_$C(13),"   ")  ;replace tab,lf,cr with space</div></div><div  class=cdline ><div  class=cdrinum >108c</div><div  class=cdmcmd > I $E($G(X))=" " F i=1:1:$L(X) I $E(X,i)'=" " S X=$E(X,i,999) Q</div></div><div  class=cdline ><div  class=cdrinum >109c</div><div  class=cdmcmd > I $E(X,$L(X))=" " F i=$L(X):-1:1 I $E(X,i)'=" " S X=$E(X,1,i) Q</div></div><div  class=cdline ><div  class=cdrinum >110c</div><div  class=cdmcmd > I X=" " S X=""  ; Funny case all spaces  vs end i=0 second <a href=CB-hghTemplate-line.cb2.html >line</a> ?</div></div><div  class=cdline ><div  class=cdrinum >111c</div><div  class=cdmcmd > Q X</div></div><div  class=cdline ><div  class=cdrinum >112c</div><div  class=cdmcmd >;* </div></div></div><div  class=ft >by ^mwHmr 16 APR 2023 11:32 PM</div><h3> 16APR2023 23:32   by ^hgh</h3>
</body>
</html>
